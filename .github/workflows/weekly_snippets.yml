name: Weekly Snippets

permissions:
  contents: read
  issues: write

on:
  workflow_dispatch:
  # schedule:
  #   - cron: "0 0 * * 4" # Every Thursday at 12:00 AM

jobs:
  weekly-snippets:
    name: Create Weekly Snippet Issue
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Close previous week's issue
        run: |
          issue_number=$(gh issue list --label "snippets" --limit 1 --json number --jq 'sort_by(.created_at) | reverse | .[0].number')
          echo "IssueNumber: $issue_number"
          if [ -n "$issue_number" ]; then
            gh issue close $issue_number
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create this week's issue
        uses: JasonEtco/create-an-issue@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          filename: .github/weekly-snippets-template.md
